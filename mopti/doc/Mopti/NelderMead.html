<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Mopti::NelderMead
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Mopti::NelderMead";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (N)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Mopti.html" title="Mopti (module)">Mopti</a></span></span>
     &raquo; 
    <span class="title">NelderMead</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Mopti::NelderMead
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Mopti::NelderMead</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>Enumerable</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mopti/nelder_mead.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>NelderMead is a class that implements multivariate optimization using the Nelder-Mead simplex method.</p>

<p><strong>Reference</strong></p>
<ol><li>
<p>Gao, F. and Han, L., “Implementing the Nelder-Mead simplex algorithm with adaptive parameters,” Computational Optimization and Applications, vol. 51 (1), pp. 259–277, 2012.</p>
</li></ol>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>numo/narray</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mopti</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='const'>Numo</span><span class='op'>::</span><span class='const'>DFloat</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span>

<span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='id identifier rubyid_proc'>proc</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='lparen'>(</span><span class='int'>8</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>-</span> <span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span><span class='op'>**</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_x0'>x0</span> <span class='op'>=</span> <span class='const'>Numo</span><span class='op'>::</span><span class='const'>DFloat</span><span class='period'>.</span><span class='id identifier rubyid_zeros'>zeros</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>

<span class='id identifier rubyid_optimizer'>optimizer</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Mopti.html" title="Mopti (module)">Mopti</a></span></span><span class='op'>::</span><span class='const'>NelderMead</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Mopti::NelderMead#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>fnc:</span> <span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='label'>x_init:</span> <span class='id identifier rubyid_x0'>x0</span><span class='comma'>,</span> <span class='label'>args:</span> <span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_optimizer'>optimizer</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_params'>params</span><span class='op'>|</span> <span class='id identifier rubyid_params'>params</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>

<span class='id identifier rubyid_pp'>pp</span> <span class='id identifier rubyid_result'>result</span>

<span class='comment'># {:x=&gt;Numo::DFloat(view)#shape=[2]
</span><span class='comment'># [2, 3],
</span><span class='comment'>#  :n_fev=&gt;165,
</span><span class='comment'>#  :n_iter=&gt;84,
</span><span class='comment'>#  :fnc=&gt;5.694864987422661e-13}</span></code></pre>
    
  </div>


</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong>(&amp;block)  &#x21d2; Enumerator </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Iteration for optimization.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(fnc:, x_init:, args: nil, max_iter: nil, xtol: 1e-6, ftol: 1e-6)  &#x21d2; NelderMead </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new optimizer with the Nelder-Mead simplex method.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(fnc:, x_init:, args: nil, max_iter: nil, xtol: 1e-6, ftol: 1e-6)  &#x21d2; <tt><span class='object_link'><a href="" title="Mopti::NelderMead (class)">NelderMead</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new optimizer with the Nelder-Mead simplex method.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>fnc</span>
      
      
        <span class='type'>(<tt>Method/Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Method for calculating the objective function to be minimized.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>Array/Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Arguments pass to the ‘fnc’ and ‘jcb’.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>x_init</span>
      
      
        <span class='type'>(<tt>Numo::NArray</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Initial point.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>max_iter</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Maximum number of iterations. If nil is given, max_iter sets to 200 * number of dimensions.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>xtol</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1e-6</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Tolerance for termination for the optimal vector norm.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>ftol</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1e-6</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Tolerance for termination for the objective function value.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43
44
45
46
47
48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mopti/nelder_mead.rb', line 41</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='label'>fnc:</span><span class='comma'>,</span> <span class='label'>x_init:</span><span class='comma'>,</span> <span class='label'>args:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>max_iter:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>xtol:</span> <span class='float'>1e-6</span><span class='comma'>,</span> <span class='label'>ftol:</span> <span class='float'>1e-6</span><span class='rparen'>)</span>
  <span class='ivar'>@fnc</span> <span class='op'>=</span> <span class='id identifier rubyid_fnc'>fnc</span>
  <span class='ivar'>@args</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='ivar'>@x_init</span> <span class='op'>=</span> <span class='id identifier rubyid_x_init'>x_init</span>
  <span class='ivar'>@max_iter</span> <span class='op'>=</span> <span class='id identifier rubyid_max_iter'>max_iter</span>
  <span class='ivar'>@xtol</span> <span class='op'>=</span> <span class='id identifier rubyid_xtol'>xtol</span>
  <span class='ivar'>@ftol</span> <span class='op'>=</span> <span class='id identifier rubyid_ftol'>ftol</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="each-instance_method">
  
    #<strong>each</strong>(&amp;block)  &#x21d2; <tt>Enumerator</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Iteration for optimization.</p>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>{ x:, n_fev:, n_jev:, n_iter:, fnc:, jcb: }</p>
<ul><li>
<p>x [Numo::NArray] Updated vector by optimization.</p>
</li><li>
<p>n_fev [Interger] Number of calls of the objective function.</p>
</li><li>
<p>n_iter [Integer] Number of iterations.</p>
</li><li>
<p>fnc [Float] Value of the objective function.</p>
</li></ul>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Enumerator</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If block is not given, this method returns Enumerator.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mopti/nelder_mead.rb', line 59</span>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_to_enum'>to_enum</span><span class='lparen'>(</span><span class='id identifier rubyid___method__'>__method__</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

  <span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='ivar'>@x_init</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='id identifier rubyid_max_iter'>max_iter</span> <span class='op'>=</span> <span class='ivar'>@max_iter</span> <span class='op'>||</span> <span class='int'>200</span> <span class='op'>*</span> <span class='id identifier rubyid_n'>n</span>

  <span class='id identifier rubyid_alpha'>alpha</span> <span class='op'>=</span> <span class='float'>1.0</span>
  <span class='id identifier rubyid_beta'>beta</span> <span class='op'>=</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>+</span> <span class='int'>2</span><span class='period'>.</span><span class='id identifier rubyid_fdiv'>fdiv</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='float'>2.0</span>
  <span class='id identifier rubyid_gamma'>gamma</span> <span class='op'>=</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='op'>?</span> <span class='float'>0.75</span> <span class='op'>-</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_fdiv'>fdiv</span><span class='lparen'>(</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='float'>0.5</span>
  <span class='id identifier rubyid_delta'>delta</span> <span class='op'>=</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>-</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_fdiv'>fdiv</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='float'>0.5</span>

  <span class='id identifier rubyid_sim'>sim</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_zeros'>zeros</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span>
  <span class='id identifier rubyid_n'>n</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span>
    <span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='id identifier rubyid_y'>y</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span> <span class='op'>?</span> <span class='const'>ZERO_TAU</span> <span class='op'>:</span> <span class='lparen'>(</span><span class='int'>1</span> <span class='op'>+</span> <span class='const'>NON_ZERO_TAU</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_y'>y</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_y'>y</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_fsim'>fsim</span> <span class='op'>=</span> <span class='const'>Numo</span><span class='op'>::</span><span class='const'>DFloat</span><span class='period'>.</span><span class='id identifier rubyid_zeros'>zeros</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span>

  <span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_func'>func</span><span class='lparen'>(</span><span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@args</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_n_fev'>n_fev</span> <span class='op'>=</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>+</span> <span class='int'>1</span>

  <span class='id identifier rubyid_ind'>ind</span> <span class='op'>=</span> <span class='id identifier rubyid_fsim'>fsim</span><span class='period'>.</span><span class='id identifier rubyid_sort_index'>sort_index</span>
  <span class='id identifier rubyid_fsim'>fsim</span> <span class='op'>=</span> <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='id identifier rubyid_ind'>ind</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_sim'>sim</span> <span class='op'>=</span> <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='id identifier rubyid_ind'>ind</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>

  <span class='id identifier rubyid_n_iter'>n_iter</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_n_iter'>n_iter</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_max_iter'>max_iter</span>
    <span class='kw'>break</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span> <span class='op'>&lt;=</span> <span class='ivar'>@xtol</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span> <span class='op'>&lt;=</span> <span class='ivar'>@ftol</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_xbar'>xbar</span> <span class='op'>=</span> <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>...</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_n'>n</span>
    <span class='id identifier rubyid_xr'>xr</span> <span class='op'>=</span> <span class='id identifier rubyid_xbar'>xbar</span> <span class='op'>+</span> <span class='id identifier rubyid_alpha'>alpha</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_xbar'>xbar</span> <span class='op'>-</span> <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fr'>fr</span> <span class='op'>=</span> <span class='id identifier rubyid_func'>func</span><span class='lparen'>(</span><span class='id identifier rubyid_xr'>xr</span><span class='comma'>,</span> <span class='ivar'>@args</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_n_fev'>n_fev</span> <span class='op'>+=</span> <span class='int'>1</span>

    <span class='id identifier rubyid_shrink'>shrink</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_fr'>fr</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_xe'>xe</span> <span class='op'>=</span> <span class='id identifier rubyid_xbar'>xbar</span> <span class='op'>+</span> <span class='id identifier rubyid_beta'>beta</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_xr'>xr</span> <span class='op'>-</span> <span class='id identifier rubyid_xbar'>xbar</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fe'>fe</span> <span class='op'>=</span> <span class='id identifier rubyid_func'>func</span><span class='lparen'>(</span><span class='id identifier rubyid_xe'>xe</span><span class='comma'>,</span> <span class='ivar'>@args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_n_fev'>n_fev</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_shrink'>shrink</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_fe'>fe</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_fr'>fr</span>
        <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_xe'>xe</span>
        <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_fe'>fe</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_xr'>xr</span>
        <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_fr'>fr</span>
      <span class='kw'>end</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_fr'>fr</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_shrink'>shrink</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_xr'>xr</span>
      <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_fr'>fr</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_fr'>fr</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_xoc'>xoc</span> <span class='op'>=</span> <span class='id identifier rubyid_xbar'>xbar</span> <span class='op'>+</span> <span class='id identifier rubyid_gamma'>gamma</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_xr'>xr</span> <span class='op'>-</span> <span class='id identifier rubyid_xbar'>xbar</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_foc'>foc</span> <span class='op'>=</span> <span class='id identifier rubyid_func'>func</span><span class='lparen'>(</span><span class='id identifier rubyid_xoc'>xoc</span><span class='comma'>,</span> <span class='ivar'>@args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_n_fev'>n_fev</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_foc'>foc</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_fr'>fr</span>
        <span class='id identifier rubyid_shrink'>shrink</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_xoc'>xoc</span>
        <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_foc'>foc</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_xic'>xic</span> <span class='op'>=</span> <span class='id identifier rubyid_xbar'>xbar</span> <span class='op'>-</span> <span class='id identifier rubyid_gamma'>gamma</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_xr'>xr</span> <span class='op'>-</span> <span class='id identifier rubyid_xbar'>xbar</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fic'>fic</span> <span class='op'>=</span> <span class='id identifier rubyid_func'>func</span><span class='lparen'>(</span><span class='id identifier rubyid_xic'>xic</span><span class='comma'>,</span> <span class='ivar'>@args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_n_fev'>n_fev</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_fic'>fic</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_shrink'>shrink</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_xic'>xic</span>
        <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_fic'>fic</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_shrink'>shrink</span>
      <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span>
        <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_delta'>delta</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_func'>func</span><span class='lparen'>(</span><span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@args</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_n_fev'>n_fev</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_ind'>ind</span> <span class='op'>=</span> <span class='id identifier rubyid_fsim'>fsim</span><span class='period'>.</span><span class='id identifier rubyid_sort_index'>sort_index</span>
    <span class='id identifier rubyid_sim'>sim</span> <span class='op'>=</span> <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='id identifier rubyid_ind'>ind</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='id identifier rubyid_fsim'>fsim</span> <span class='op'>=</span> <span class='id identifier rubyid_fsim'>fsim</span><span class='lbracket'>[</span><span class='id identifier rubyid_ind'>ind</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>

    <span class='id identifier rubyid_n_iter'>n_iter</span> <span class='op'>+=</span> <span class='int'>1</span>

    <span class='kw'>yield</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='label'>x:</span> <span class='id identifier rubyid_sim'>sim</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>n_fev:</span> <span class='id identifier rubyid_n_fev'>n_fev</span><span class='comma'>,</span> <span class='label'>n_iter:</span> <span class='id identifier rubyid_n_iter'>n_iter</span><span class='comma'>,</span> <span class='label'>fnc:</span> <span class='id identifier rubyid_fsim'>fsim</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Apr  9 20:20:13 2022 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-3.1.1).
</div>

    </div>
  </body>
</html>